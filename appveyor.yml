image: Visual Studio 2022

environment:
  NODE_CONFIG: '{"db": {"host": "localhost"}}'
  PGUSER: postgres
  PGPASSWORD: Password12!
  POSTGRES_PATH: C:\Program Files\PostgreSQL\13
  nodejs_version: 16
  matrix:
    - TARGET: test
    - TARGET: test-multi

services:
  - postgresql13

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - ps: Install-Product node $env:nodejs_version
  - node --version
  - npm install

before_test:
  # stopping docker speeds things up
  - ps: Stop-Service -Name "*docker*"
  - set path=%postgres_path%\\bin;%path%
  - "psql -c \"create database \\\"qlobber-pg\\\";\""

test_script:
  - npm run migrate up
  - npm run %TARGET%

build: off
